<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>xQuera - Ana Sayfa</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="firebase.js"></script>
</head>
<body>
  <header>
    <h1>xQuera Chat</h1>
    <div>
      <span id="usernameDisplay"></span>
      <button onclick="logout()">√áƒ±kƒ±≈ü</button>
    </div>
  </header>

  <main>
    <section class="room-list">
      <h2>üïπÔ∏è Oyun Odalarƒ±</h2>
      <div id="gameRooms"></div>

      <h2>üí¨ Sohbet Odalarƒ±</h2>
      <div id="chatRooms"></div>
    </section>

    <section class="create-room">
      <h3>Yeni oda olu≈ütur</h3>
      <input id="roomNameInput" placeholder="Oda adƒ±...">
      <select id="roomType">
        <option value="chat">Sohbet</option>
        <option value="game">Oyun</option>
      </select>
      <button id="createRoomBtn">Olu≈ütur</button>
    </section>
  </main>

  <footer>
    <p class="devtag">Developed by <span>xQuera</span></p>
  </footer>

  <script type="module">
    import { db, ref, set, onValue, push } from "./firebase.js";

    const username = localStorage.getItem("username");
    if(!username) window.location.href = "index.html";

    document.getElementById("usernameDisplay").innerText = "üë§ " + username;

    const gameRef = ref(db, "rooms/game/");
    const chatRef = ref(db, "rooms/chat/");

    const renderRooms = (snapshot, containerId, type) => {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      snapshot.forEach(room => {
        const name = room.key;
        const users = room.val().users ? Object.keys(room.val().users).length : 0;
        const div = document.createElement("div");
        div.className = "room-card";
        div.innerHTML = `<strong>${name}</strong><br><span>${users} ki≈üi</span>`;
        div.onclick = () => {
          localStorage.setItem("room", name);
          window.location.href = "room.html?type=" + type;
        };
        container.appendChild(div);
      });
    };

    onValue(gameRef, snap => renderRooms(snap, "gameRooms", "game"));
    onValue(chatRef, snap => renderRooms(snap, "chatRooms", "chat"));

    // Yeni oda olu≈ütur
    document.getElementById("createRoomBtn").addEventListener("click", async () => {
      const name = document.getElementById("roomNameInput").value.trim();
      const type = document.getElementById("roomType").value;
      if(name.length < 2) return alert("Oda adƒ± √ßok kƒ±sa!");

      await set(ref(db, `rooms/${type}/${name}`), {
        createdBy: username,
        users: {},
        messages: {}
      });
      alert("Oda olu≈üturuldu!");
    });

    window.logout = () => {
      localStorage.removeItem("username");
      window.location.href = "index.html";
    };
  </script>
</body>
</html>    const gameRef = ref(db, "rooms/game/");
    const chatRef = ref(db, "rooms/chat/");

    const renderRooms = (snapshot, containerId, type) => {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      snapshot.forEach(room => {
        const roomName = room.key;
        const users = room.val()?.users ? Object.keys(room.val().users).length : 0;
        const div = document.createElement("div");
        div.className = "room-card";
        div.innerHTML = `<strong>${roomName}</strong><br><span>${users} ki≈üi</span>`;
        div.onclick = () => {
          localStorage.setItem("room", roomName);
          window.location.href = "room.html?type=" + type;
        };
        container.appendChild(div);
      });
    };

    onValue(gameRef, snap => renderRooms(snap, "gameRooms", "game"));
    onValue(chatRef, snap => renderRooms(snap, "chatRooms", "chat"));

    window.logout = () => {
      localStorage.removeItem("username");
      window.location.href = "index.html";
    };
  </script>
</body>
</html>
